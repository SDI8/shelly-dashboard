# NanoMQ Configuration

system {
    num_taskq_thread = 2
    max_taskq_thread = 4
    parallel = 2
}

mqtt {
    # Maximum packet size (1MB for JSON payloads)
    max_packet_size = 1MB
    
    # Message queue settings optimized for IoT devices
    max_mqueue_len = 2048
    retry_interval = 10s
    keepalive_multiplier = 1.25
    
    property_size = 32
    msq_len = 64
    qos_duration = 30s
    
    # Session settings
    max_inflight_window = 32
    max_awaiting_rel = 10
    await_rel_timeout = 10s
}

# TCP Listener for MQTT
listeners.tcp {
    bind = "0.0.0.0:1883"
    
    max_connections = 1024
    backlog = 128
}

# WebSocket Listener
listeners.ws {
    bind = "0.0.0.0:8083"
    max_connections = 64
    backlog = 16
}

# SSL/TLS Listener disabled
# listeners.ssl {
#     bind = "0.0.0.0:8883"
#     max_connections = 512
#     backlog = 64
#     keyfile = "/etc/certs/key.pem"
#     certfile = "/etc/certs/cert.pem"
# }

# Logging configuration
log {
    to = [file, console]
    level = info
    dir = "/tmp"
    file = "nanomq.log"
    rotation = {
        size = "10MB"
        count = 5
    }
}