# Shelly Cover Shutter Status Configuration
# Topics: /status/cover:0, /status/cover:1

[[inputs.mqtt_consumer]]
  name_override = "shelly_cover"
  servers = ["tcp://nanomq:1883"]
  topics = ["+/status/cover:0", "+/status/cover:1"]
  qos = 0
  connection_timeout = "30s"
  client_id = "telegraf-cover-status"
  data_format = "json_v2"
  
  [[inputs.mqtt_consumer.topic_parsing]]
    topic = "+/status/+"
    tags = "device_full/_/component_id"
  
  [[inputs.mqtt_consumer.json_v2]]
    measurement_name = "shelly_cover"
    timestamp_path = ""
    timestamp_format = ""
    
    [[inputs.mqtt_consumer.json_v2.field]]
      path = "id"
      type = "int"

    [[inputs.mqtt_consumer.json_v2.field]]
      path = "source"
      type = "string"
      optional = true

    # Cover state and position
    [[inputs.mqtt_consumer.json_v2.field]]
      path = "state"
      type = "string"
      optional = true

    [[inputs.mqtt_consumer.json_v2.field]]
      path = "current_pos"
      type = "int"
      optional = true

    [[inputs.mqtt_consumer.json_v2.field]]
      path = "target_pos"
      type = "int"
      optional = true

    # Power measurements
    [[inputs.mqtt_consumer.json_v2.field]]
      path = "apower"
      type = "float"
      optional = true

    [[inputs.mqtt_consumer.json_v2.field]]
      path = "voltage"
      type = "float"
      optional = true

    [[inputs.mqtt_consumer.json_v2.field]]
      path = "current"
      type = "float"
      optional = true

    [[inputs.mqtt_consumer.json_v2.field]]
      path = "pf"
      type = "float"
      optional = true

    # Energy measurements
    [[inputs.mqtt_consumer.json_v2.field]]
      path = "aenergy.total"
      rename = "aenergy_total"
      type = "float"
      optional = true

    [[inputs.mqtt_consumer.json_v2.field]]
      path = "aenergy.by_minute"
      rename = "aenergy_by_minute"
      type = "float"
      optional = true

    [[inputs.mqtt_consumer.json_v2.field]]
      path = "aenergy.minute_ts"
      rename = "aenergy_minute_ts"
      type = "int"
      optional = true

    # Temperature monitoring
    [[inputs.mqtt_consumer.json_v2.field]]
      path = "temperature.tC"
      rename = "temperature_celsius"
      type = "float"
      optional = true

    [[inputs.mqtt_consumer.json_v2.field]]
      path = "temperature.tF"
      rename = "temperature_fahrenheit"
      type = "float"
      optional = true

    # Positioning source
    [[inputs.mqtt_consumer.json_v2.field]]
      path = "pos_control"
      type = "bool"
      optional = true

    # Safety and calibration
    [[inputs.mqtt_consumer.json_v2.field]]
      path = "safety_switch"
      type = "bool"
      optional = true

    [[inputs.mqtt_consumer.json_v2.field]]
      path = "move_timeout"
      type = "int"
      optional = true

    [[inputs.mqtt_consumer.json_v2.field]]
      path = "move_started_at"
      type = "int"
      optional = true

    # Errors
    [[inputs.mqtt_consumer.json_v2.field]]
      path = "errors"
      type = "string"
      optional = true